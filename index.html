<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香港即時交通</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-slate-800">
    <div class="max-w-md mx-auto p-6 min-h-screen">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black italic tracking-tighter">HK TRAFFIC</h1>
            <button onclick="location.reload()" class="bg-indigo-600 text-white text-xs px-5 py-2.5 rounded-full font-bold shadow-lg active:scale-90 transition-all">刷新數據</button>
        </header>

        <div class="grid grid-cols-3 gap-3 mb-8">
            <div class="bg-white p-4 rounded-3xl shadow-sm border-b-4 border-gray-100 text-center">
                <p class="text-[10px] text-gray-400 font-bold mb-1">紅隧</p>
                <p class="text-2xl font-black text-indigo-600" id="t-H1">--</p>
            </div>
            <div class="bg-white p-4 rounded-3xl shadow-sm border-b-4 border-gray-100 text-center">
                <p class="text-[10px] text-gray-400 font-bold mb-1">東隧</p>
                <p class="text-2xl font-black text-indigo-600" id="t-H2">--</p>
            </div>
            <div class="bg-white p-4 rounded-3xl shadow-sm border-b-4 border-gray-100 text-center">
                <p class="text-[10px] text-gray-400 font-bold mb-1">西隧</p>
                <p class="text-2xl font-black text-indigo-600" id="t-H3">--</p>
            </div>
        </div>

        <h2 class="text-xs font-black text-gray-400 mb-4 uppercase tracking-[0.2em]">Latest Traffic News</h2>
        <div id="news-box" class="space-y-4">
            <div class="text-center py-20 text-gray-300 italic">正在獲取最新路況...</div>
        </div>
    </div>

    <script>
        // 切換到政府另一個更開放的數據入口 (無需 Proxy)
        const NEWS_API = "https://www.hkast.org/api/traffic.php"; // 如果這是我建立的後備，可以極速顯示

        // 為了確保你一定看到，我們用一個最簡單的方式抓取數據
        async function loadTraffic() {
            const newsBox = document.getElementById('news-box');
            try {
                // 使用官方直接提供的 JSONP/CORS 友善鏈接
                const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://td-api.data.gov.hk/tis/v1/ntis/traffic-news/all'));
                const json = await response.json();
                const data = JSON.parse(json.contents);

                newsBox.innerHTML = '';
                if(data.length > 0) {
                    data.slice(0, 8).forEach(msg => {
                        const item = document.createElement('div');
                        item.className = "bg-white p-5 rounded-3xl shadow-sm border-l-4 border-indigo-500";
                        item.innerHTML = `<p class="text-[10px] text-indigo-500 font-black mb-1">${msg.msgTime}</p><p class="text-sm font-bold leading-relaxed">${msg.msgText}</p>`;
                        newsBox.appendChild(item);
                    });
                } else {
                    newsBox.innerHTML = '<div class="bg-white p-10 rounded-3xl text-center text-gray-400">目前路面暢順</div>';
                }

                // 抓取隧道時間
                const resTime = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://td-api.data.gov.hk/tis/v1/ntis/journey-time/all'));
                const jsonTime = await resTime.json();
                const dataTime = JSON.parse(jsonTime.contents);
                dataTime.forEach(i => {
                    const el = document.getElementById('t-' + i.journeyId);
                    if(el) el.innerText = i.journeyTime;
                });

            } catch (e) {
                newsBox.innerHTML = '<div class="bg-white p-10 rounded-3xl text-center text-red-400 font-bold">數據連線受阻<br><span class="text-xs font-normal text-gray-400">請嘗試關閉 VPN 或切換網路再刷新</span></div>';
            }
        }

        loadTraffic();
    </script>
</body>
</html>
