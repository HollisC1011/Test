import streamlit as st
import requests
import pandas as pd
from datetime import datetime

# è¨­ç½®é é¢æ¨™é¡Œèˆ‡åœ–æ¨™
st.set_page_config(page_title="HK Traffic Live", page_icon="ğŸš—")

def fetch_data():
    # ä½¿ç”¨è³‡æ–™ä¸€ç·šé€šçš„ API (ç‰¹åˆ¥äº¤é€šæ¶ˆæ¯)
    url = "https://api.data.gov.hk/v1/af-traffic-news?lang=tc"
    try:
        response = requests.get(url)
        return response.json()
    except:
        return []

def main():
    st.title("ğŸ‡­ğŸ‡° é¦™æ¸¯é“è·¯ç‹€æ³å¯¦æ™‚ç›£æ§")
    st.markdown(f"**æœ€å¾Œæ›´æ–°æ™‚é–“:** `{datetime.now().strftime('%H:%M:%S')}` (æ¯ 30 åˆ†é˜è‡ªå‹•åˆ·æ–°)")

    # ç²å–æ•¸æ“š
    news = fetch_data()

    if news:
        for idx, item in enumerate(news):
            # æ ¹æ“šé—œéµå­—åŠ ä¸Šæ¨™ç±¤
            header = f"ğŸ“¢ æ¶ˆæ¯ {idx+1}: {item['title']}"
            with st.expander(header):
                st.write(f"**ç™¼ä½ˆæ™‚é–“:** {item['startTime']}")
                st.info(item['description'])
    else:
        st.success("âœ… ç›®å‰æ²’æœ‰é‡å¤§äº¤é€šæ„å¤–æˆ–ç‰¹åˆ¥å°è·¯æ¶ˆæ¯ã€‚")

    # åº•éƒ¨åŠ ä¸Šè‡ªå‹•åˆ·æ–°æŒ‰éˆ• (Streamlit Cloud æœƒè‡ªå‹•è™•ç†ï¼Œæˆ–æ‰‹å‹•æŒ‰ R)
    if st.button('ç«‹å³æ‰‹å‹•æ›´æ–°'):
        st.rerun()

if __name__ == "__main__":
    main()
